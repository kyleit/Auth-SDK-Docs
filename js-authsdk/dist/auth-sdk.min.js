!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).AuthSDK={})}(this,function(e){"use strict";class t{constructor(e="auth"){this.prefix=e}get accessToken(){return localStorage.getItem(`${this.prefix}_access_token`)}set accessToken(e){localStorage.setItem(`${this.prefix}_access_token`,e)}get refreshToken(){return localStorage.getItem(`${this.prefix}_refresh_token`)}set refreshToken(e){localStorage.setItem(`${this.prefix}_refresh_token`,e)}clear(){localStorage.removeItem(`${this.prefix}_access_token`),localStorage.removeItem(`${this.prefix}_refresh_token`)}}e.AuthClient=class{constructor({baseUrl:e,loginPath:t="/api/v1/auth/login",refreshPath:s="/api/v1/auth/refresh",introspectPath:r="/api/v1/auth/introspect",headers:o={}}){this.baseUrl=e.replace(/\/$/,""),this.loginUrl=this.baseUrl+t,this.refreshUrl=this.baseUrl+s,this.introspectUrl=this.baseUrl+r,this.headers={"Content-Type":"application/json",...o}}async login(e,t,s=null,r={}){const o={username:e,password:t,...r};s&&(o.totp=s);const a=await fetch(this.loginUrl,{method:"POST",headers:this.headers,body:JSON.stringify(o)});if(!a.ok)throw new Error(`Login failed: ${a.statusText}`);return a.json()}async refresh(e){const t=await fetch(this.refreshUrl,{method:"POST",headers:this.headers,body:JSON.stringify({refresh_token:e})});if(!t.ok)throw new Error(`Refresh failed: ${t.statusText}`);return t.json()}async introspect(e){const t=await fetch(this.introspectUrl,{method:"POST",headers:this.headers,body:JSON.stringify({token:e})});if(!t.ok)throw new Error(`Introspect failed: ${t.statusText}`);return t.json()}},e.AuthFetch=class{constructor(e,s=new t){this.client=e,this.storage=s}async fetch(e,t={}){const s=this.storage.accessToken,r=new Headers(t.headers||{});s&&r.set("Authorization",`Bearer ${s}`);let o=await fetch(e,{...t,headers:r});if(401===o.status&&this.storage.refreshToken)try{const s=await this.client.refresh(this.storage.refreshToken);this.storage.accessToken=s.access_token,this.storage.refreshToken=s.refresh_token,r.set("Authorization",`Bearer ${this.storage.accessToken}`),o=await fetch(e,{...t,headers:r})}catch(e){throw this.storage.clear(),new Error("Unauthorized, please login again")}return o}},e.TokenStorage=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});